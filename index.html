
<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Request Fields</title>
	<style>
		html, body {
			font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
			margin: 0;
			background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
			color: #1a202c;
			min-height: 100vh;
		}
		.container {
			max-width: 720px;
			margin: 2em auto;
			background: rgba(255, 255, 255, 0.95);
			backdrop-filter: blur(20px);
			border-radius: 24px;
			box-shadow: 0 20px 40px rgba(0,0,0,0.1), 0 8px 32px rgba(0,0,0,0.08);
			padding: 3em 2.5em;
			border: 1px solid rgba(255,255,255,0.2);
		}
		h2 {
			color: #2563eb;
			margin-top: 0;
			font-size: 1.75em;
			font-weight: 700;
			letter-spacing: -0.025em;
			background: linear-gradient(135deg, #2563eb 0%, #7c3aed 100%);
			-webkit-background-clip: text;
			-webkit-text-fill-color: transparent;
			background-clip: text;
		}
		.field-list {
			margin-bottom: 1.2em;
		}
		.field-input {
			width: 100%;
			padding: 0.875em 1.25em;
			border: 2px solid #e5e7eb;
			border-radius: 12px;
			font-size: 1rem;
			margin-bottom: 1em;
			transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
			background: rgba(255, 255, 255, 0.9);
			backdrop-filter: blur(10px);
		}
		.field-input:focus {
			outline: none;
			border-color: #3b82f6;
			box-shadow: 0 0 0 4px rgba(59, 130, 246, 0.15);
			transform: translateY(-1px);
		}
		.btn-primary {
			background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
			color: #ffffff;
			border: none;
			border-radius: 12px;
			padding: 0.875em 2em;
			font-size: 1rem;
			font-weight: 600;
			cursor: pointer;
			transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
			margin-right: 0.75em;
			margin-bottom: 0.75em;
			box-shadow: 0 4px 6px rgba(59, 130, 246, 0.25);
		}
		.btn-primary:hover {
			transform: translateY(-2px);
			box-shadow: 0 8px 16px rgba(59, 130, 246, 0.4);
		}
		.btn-primary:disabled {
			opacity: 0.6;
			cursor: not-allowed;
			transform: none;
		}
		.btn-secondary {
			background: rgba(248, 250, 252, 0.8);
			color: #64748b;
			border: 2px solid #e2e8f0;
			border-radius: 10px;
			padding: 0.625em 1.25em;
			font-size: 0.925rem;
			font-weight: 500;
			cursor: pointer;
			transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
			margin-left: 0.5em;
			backdrop-filter: blur(10px);
		}
		.btn-secondary:hover {
			background: rgba(226, 232, 240, 0.9);
			border-color: #cbd5e1;
			transform: translateY(-1px);
		}
		.id-box {
			margin-top: 2em;
			font-weight: 600;
			color: #1e40af;
			background: linear-gradient(135deg, rgba(147, 197, 253, 0.2) 0%, rgba(196, 181, 253, 0.2) 100%);
			border: 2px solid rgba(147, 197, 253, 0.3);
			border-radius: 16px;
			padding: 1.25em 1.5em;
			display: inline-flex;
			align-items: center;
			gap: 1em;
			font-size: 1.125rem;
			user-select: all;
			box-shadow: 0 4px 16px rgba(59, 130, 246, 0.15);
			backdrop-filter: blur(20px);
		}
		.copy-btn {
			background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
			color: #ffffff;
			border: none;
			border-radius: 8px;
			padding: 0.5em 1em;
			font-size: 0.875rem;
			font-weight: 500;
			margin-left: 0.5em;
			cursor: pointer;
			transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
			box-shadow: 0 2px 8px rgba(99, 102, 241, 0.25);
		}
		.copy-btn:hover {
			transform: translateY(-2px);
			box-shadow: 0 6px 16px rgba(99, 102, 241, 0.4);
		}
		.loading-spinner {
			display: inline-block;
			width: 18px;
			height: 18px;
			border: 2.5px solid rgba(255, 255, 255, 0.3);
			border-top: 2.5px solid #3b82f6;
			border-radius: 50%;
			animation: spin 1s linear infinite;
			margin-right: 0.5em;
		}
		@keyframes spin {
			0% { transform: rotate(0deg); }
			100% { transform: rotate(360deg); }
		}
		.single-upload-form {
			background: rgba(248, 250, 252, 0.8);
			backdrop-filter: blur(10px);
			border: 1px solid rgba(226, 232, 240, 0.6);
			border-radius: 16px;
			padding: 1.5em;
			margin-bottom: 1.5em;
			display: flex;
			align-items: center;
			gap: 1.5em;
			box-shadow: 0 4px 16px rgba(0,0,0,0.05);
			flex-wrap: wrap;
			transition: all 0.3s ease;
		}
		.single-upload-form:hover {
			transform: translateY(-2px);
			box-shadow: 0 8px 24px rgba(0,0,0,0.1);
		}
		.single-upload-form label {
			flex: 1 1 200px;
			font-size: 1.1rem;
			font-weight: 600;
			color: #374151;
			display: flex;
			align-items: center;
			gap: 1em;
		}
		.single-upload-form input[type="file"] {
			font-size: 0.95rem;
			background: rgba(255, 255, 255, 0.9);
			border-radius: 10px;
			border: 2px solid #e5e7eb;
			padding: 0.5em 0.75em;
			transition: all 0.3s ease;
		}
		.single-upload-form input[type="file"]:focus {
			border-color: #3b82f6;
			box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
		}
		.single-upload-form button {
			background: linear-gradient(135deg, #10b981 0%, #059669 100%);
			color: #ffffff;
			border: none;
			border-radius: 10px;
			padding: 0.75em 1.5em;
			cursor: pointer;
			font-weight: 600;
			font-size: 0.95rem;
			transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
			box-shadow: 0 2px 8px rgba(16, 185, 129, 0.25);
		}
		.single-upload-form button:hover {
			transform: translateY(-1px);
			box-shadow: 0 4px 12px rgba(16, 185, 129, 0.4);
		}
		.single-upload-form button:disabled {
			opacity: 0.6;
			cursor: not-allowed;
			transform: none;
		}
		.upload-status {
			min-width: 120px;
			font-size: 0.95rem;
			font-weight: 600;
			color: #047857;
			margin-left: 0.75em;
			display: flex;
			align-items: center;
			gap: 0.5em;
		}
		.upload-status.error {
			color: #dc2626;
		}
		.upload-status a {
			color: #3b82f6;
			text-decoration: none;
			margin-left: 0.5em;
			display: flex;
			align-items: center;
			gap: 0.375em;
			font-weight: 500;
			padding: 0.25em 0.5em;
			border-radius: 6px;
			transition: all 0.2s ease;
		}
		.upload-status a:hover {
			background: rgba(59, 130, 246, 0.1);
			text-decoration: underline;
		}
		.file-icon {
			width: 1.1em;
			height: 1.1em;
			vertical-align: middle;
			margin-right: 0.1em;
			display: inline-block;
		}
		.section {
			margin-bottom: 2.5em;
		}
		@media (max-width: 768px) {
			.container {
				margin: 1em 0.75em;
				padding: 2em 1.5em;
			}
			h2 {
				font-size: 1.5rem;
			}
			.single-upload-form {
				flex-direction: column;
				align-items: stretch;
				gap: 1.25em;
				padding: 1.25em;
			}
			.single-upload-form label {
				flex: 1 1 100%;
				margin-bottom: 0.75em;
			}
			.field-input {
				font-size: 1.125rem;
				padding: 1em;
			}
			.btn-primary, .btn-secondary {
				width: 100%;
				padding: 1em;
				margin: 0.5em 0;
				font-size: 1rem;
			}
			#idForm {
				flex-direction: column;
				align-items: stretch;
				gap: 1em;
			}
			#idForm input {
				min-width: auto;
				margin-bottom: 0.75em;
			}
			.upload-status {
				margin-left: 0;
				margin-top: 0.75em;
				justify-content: flex-start;
			}
			.id-box {
				padding: 1em;
				font-size: 1rem;
			}
		}
	</style>
<body>
<div class="container">
	<div class="section">
		<h2>üìã Enter the fields you want to upload</h2>
		<form id="fieldsForm">
			<div class="field-list" id="fieldInputs">
				<input type="text" name="field" placeholder="e.g. PAN" required class="field-input">
			</div>
			<button type="button" onclick="addField()" class="btn-secondary">‚ûï Add Another Field</button>
			<button type="submit" class="btn-primary" id="submitBtn">üöÄ Create Request</button>
		</form>
		<div class="id-box" id="idBox" style="display: none;"></div>
	</div>
	<div class="section">
		<h2>üì§ Upload Files for Your Request</h2>
		<form id="idForm" style="margin-bottom:1.5em; display: flex; align-items: center; gap: 1em; flex-wrap: wrap;">
			<label for="requestId" style="font-weight: 600;">Enter your request ID:</label>
			<input type="text" id="requestId" required class="field-input" style="flex: 1; min-width: 200px; margin-bottom: 0;">
			<button type="submit" class="btn-primary" id="fetchBtn">üîç Fetch Fields</button>
		</form>
		<div id="uploadFields"></div>
		<div class="id-box" id="uploadStatus" style="display: none;"></div>
	</div>
</div>

<script>
// SVG for file icon
const fileIconSVG = `<svg class="file-icon" fill="none" stroke="currentColor" stroke-width="1.7" viewBox="0 0 24 24"><rect x="6" y="3" width="12" height="18" rx="2" stroke="#2d6cdf"/><path d="M9 7h6M9 11h6M9 15h3" stroke="#2d6cdf"/></svg>`;
// Replace with your actual n8n webhook URL
const N8N_WEBHOOK_URL = 'https://n8n.srv898271.hstgr.cloud/webhook/995c9faa-c78e-47e4-9353-e3b6256975f5';
const N8N_FETCH_FIELDS_URL = 'https://n8n.srv898271.hstgr.cloud/webhook/fetch-fields';
const N8N_UPLOAD_FILES_URL = 'https://n8n.srv898271.hstgr.cloud/webhook/upload-file';

function addField() {
	const div = document.createElement('div');
	div.innerHTML = '<input type="text" name="field" placeholder="e.g. Aadhaar" required class="field-input"> <button type="button" onclick="this.parentNode.remove()" class="btn-secondary">‚ùå Remove</button>';
	document.getElementById('fieldInputs').appendChild(div);
}

document.getElementById('fieldsForm').addEventListener('submit', async function(e) {
	e.preventDefault();
	const fields = Array.from(document.querySelectorAll('input[name="field"]'))
		.map(input => input.value.trim())
		.filter(Boolean);
	if (fields.length === 0) {
		alert('Please enter at least one field.');
		return;
	}
	
	// Add loading state
	const submitBtn = document.getElementById('submitBtn');
	submitBtn.disabled = true;
	submitBtn.innerHTML = '<span class="loading-spinner"></span>Creating...';
	document.getElementById('idBox').style.display = 'none';
	
	try {
		const res = await fetch(N8N_WEBHOOK_URL, {
			method: 'POST',
			headers: { 'Content-Type': 'application/json' },
			body: JSON.stringify({ fields })
		});
		const data = await res.json();
		const idBox = document.getElementById('idBox');
		const submitBtn = document.getElementById('submitBtn');
		submitBtn.disabled = false;
		submitBtn.innerHTML = 'üöÄ Create Request';
		
		if (data.id) {
			idBox.innerHTML = `‚úÖ Your request ID: <span id="requestIdValue">${data.id}</span> <button class="copy-btn" onclick="copyRequestId()" title="Copy ID">üìã Copy</button>`;
			idBox.style.display = 'inline-flex';
		} else {
			idBox.innerText = '‚ùå Error: No ID returned.';
			idBox.style.display = 'inline-flex';
		}
	} catch (err) {
		const idBox = document.getElementById('idBox');
		const submitBtn = document.getElementById('submitBtn');
		submitBtn.disabled = false;
		submitBtn.innerHTML = 'üöÄ Create Request';
		idBox.innerText = '‚ùå Error submitting request.';
		idBox.style.display = 'inline-flex';
	}
});

function copyRequestId() {
	const idSpan = document.getElementById('requestIdValue');
	if (!idSpan) return;
	const text = idSpan.innerText;
	navigator.clipboard.writeText(text).then(() => {
		const btn = document.querySelector('.copy-btn');
		btn.textContent = '‚úî';
		setTimeout(() => { btn.textContent = 'üìã'; }, 1200);
	});
}

document.getElementById('idForm').addEventListener('submit', async function(e) {
	e.preventDefault();
	const id = document.getElementById('requestId').value.trim();
	if (!id) return;
	
	// Add loading state
	const fetchBtn = document.getElementById('fetchBtn');
	fetchBtn.disabled = true;
	fetchBtn.innerHTML = '<span class="loading-spinner"></span>Fetching...';
	document.getElementById('uploadStatus').style.display = 'none';
	document.getElementById('uploadFields').innerHTML = '';
	
	try {
		const res = await fetch(N8N_FETCH_FIELDS_URL, {
			method: 'POST',
			headers: { 'Content-Type': 'application/json' },
			body: JSON.stringify({ id })
		});
		const data = await res.json();
		const uploadFields = document.getElementById('uploadFields');
		const fetchBtn = document.getElementById('fetchBtn');
		fetchBtn.disabled = false;
		fetchBtn.innerHTML = 'üîç Fetch Fields';
		
		uploadFields.innerHTML = '';
		if (data.fields && Array.isArray(data.fields)) {
			data.fields.forEach(field => {
				const div = document.createElement('div');
				div.innerHTML = `
					<form class="single-upload-form" data-field="${field}">
						<label><span style="font-weight:600;">${field}:</span> <input type="file" name="file" required></label>
						<button type="submit">Upload</button>
						<span class="upload-status"></span>
					</form>
				`;
				uploadFields.appendChild(div);
			});
			// Attach event listeners to each upload form
			document.querySelectorAll('.single-upload-form').forEach(form => {
				form.addEventListener('submit', async function(ev) {
					ev.preventDefault();
					const field = this.getAttribute('data-field');
					const fileInput = this.querySelector('input[type="file"]');
					const statusSpan = this.querySelector('.upload-status');
					if (!fileInput.files.length) {
						statusSpan.textContent = 'Please select a file.';
						statusSpan.classList.add('error');
						return;
					}
					statusSpan.innerHTML = `<span class="loading-spinner"></span><span style="color:#2d6cdf;">Uploading...</span>`;
					statusSpan.classList.remove('error');
					const uploadBtn = this.querySelector('button[type="submit"]');
					uploadBtn.disabled = true;
					const formData = new FormData();
					formData.append('id', id);
					formData.append('field', field);
					formData.append('file', fileInput.files[0]);
					try {
						const res = await fetch(N8N_UPLOAD_FILES_URL, {
							method: 'POST',
							body: formData
						});
						const data = await res.json();
						uploadBtn.disabled = false;
						
						if (data.success) {
							if (data.url) {
								statusSpan.innerHTML = `‚úÖ <span style="color:#1b7e2b;">Uploaded!</span> <a href="${data.url}" target="_blank">${fileIconSVG}View File</a>`;
								statusSpan.classList.remove('error');
							} else {
								statusSpan.innerHTML = `‚úÖ <span style="color:#1b7e2b;">Uploaded!</span>`;
								statusSpan.classList.remove('error');
							}
						} else {
							statusSpan.innerHTML = `‚ùå <span style="color:#c0392b;">${data.message ? `Upload failed: ${data.message}` : 'Upload failed.'}</span>`;
							statusSpan.classList.add('error');
						}
					} catch (err) {
						uploadBtn.disabled = false;
						statusSpan.innerHTML = `‚ùå <span style="color:#c0392b;">Error uploading.</span>`;
						statusSpan.classList.add('error');
					}
				});
			});
		} else {
			uploadFields.innerHTML = '<div style="text-align: center; padding: 2em; color: #64748b;">‚ùå No fields found for this ID.</div>';
		}
	} catch (err) {
		const fetchBtn = document.getElementById('fetchBtn');
		fetchBtn.disabled = false;
		fetchBtn.innerHTML = 'üîç Fetch Fields';
		document.getElementById('uploadStatus').innerText = '‚ùå Error fetching fields.';
		document.getElementById('uploadStatus').style.display = 'inline-flex';
	}
});
</script>
</body>
</html>
</html>
